(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2163:function(e,t,s){Promise.resolve().then(s.bind(s,6399))},6399:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var a=s(7437),n=s(2265);let l="http://localhost:8080/api";async function i(){return(await fetch("".concat(l,"/conversations"),{cache:"no-store"})).json()}async function r(e){return(await fetch("".concat(l,"/messages/").concat(e),{cache:"no-store"})).json()}async function c(e){return(await fetch("".concat(l,"/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}function o(e){let{onSelect:t,active:s}=e,[l,r]=(0,n.useState)([]),[c,o]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>r(await i()))()},[]);let d=l.filter(e=>(e.name||e.wa_id||e._id).toLowerCase().includes(c.toLowerCase())),u=e=>e.wa_id||e._id;return(0,a.jsxs)("div",{className:"w-full md:w-80 border-r bg-white h-full flex flex-col",children:[(0,a.jsx)("div",{className:"p-2 sticky-header",children:(0,a.jsx)("input",{value:c,onChange:e=>o(e.target.value),placeholder:"Search or start new chat",className:"w-full px-3 py-2 rounded-lg border"})}),(0,a.jsx)("div",{className:"overflow-y-auto",children:d.map(e=>{var n,l,i;let r=u(e);return(0,a.jsxs)("button",{onClick:()=>t(r),className:"w-full text-left px-3 py-3 hover:bg-zinc-50 border-b ".concat(s===r?"bg-zinc-50":""),children:[(0,a.jsx)("div",{className:"font-medium",children:e.name||r}),(0,a.jsxs)("div",{className:"text-xs opacity-70 truncate",children:[(null===(n=e.lastMessage)||void 0===n?void 0:n.direction)==="out"?"You: ":"",null===(l=e.lastMessage)||void 0===l?void 0:l.text]}),(0,a.jsx)("div",{className:"text-[10px] opacity-60",children:(null===(i=e.lastMessage)||void 0===i?void 0:i.timestamp)&&new Date(e.lastMessage.timestamp).toLocaleString()})]},r)})})]})}function d(e){let{status:t}=e;return t?"sent"===t?(0,a.jsx)("span",{title:"sent",children:"✓"}):"delivered"===t?(0,a.jsx)("span",{title:"delivered",children:"✓✓"}):"read"===t?(0,a.jsx)("span",{title:"read",className:"text-sky-600",children:"✓✓"}):"failed"===t?(0,a.jsx)("span",{title:"failed",children:"⚠"}):null:null}function u(e){let{m:t}=e,s="out"===t.direction?"bubble-out":"bubble-in";return(0,a.jsx)("div",{className:"my-1 ".concat("out"===t.direction?"text-right":"text-left"),children:(0,a.jsxs)("div",{className:s,children:[(0,a.jsx)("div",{className:"whitespace-pre-wrap break-words",children:t.text}),(0,a.jsxs)("div",{className:"text-[10px] mt-1 opacity-70 flex items-center gap-1 justify-end",children:[(0,a.jsx)("span",{children:new Date(t.timestamp).toLocaleString()}),"out"===t.direction&&(0,a.jsx)(d,{status:t.status})]})]})})}var x=s(5040);let m=null;function f(e){let{wa_id:t}=e,[s,l]=(0,n.useState)([]),[i,o]=(0,n.useState)(""),[d,f]=(0,n.useState)(""),h=(0,n.useRef)(null);async function p(e){if(e.preventDefault(),!t||!d.trim())return;let s=await c({wa_id:t,text:d.trim(),name:i});l(e=>e.concat(s)),f("")}return((0,n.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[s]),(0,n.useEffect)(()=>{if(!t)return;(async()=>{var e;let s=await r(t);l(s),o((null===(e=s.find(e=>e.name))||void 0===e?void 0:e.name)||"")})();let e=(m||(m=(0,x.io)("http://localhost:8080",{transports:["websocket"]})),m);e.emit("join",t);let s=e=>l(t=>t.concat(e)),a=e=>l(t=>t.map(t=>t._id===e._id?e:t));return e.on("message:new",s),e.on("message:update",a),()=>{e.off("message:new",s),e.off("message:update",a)}},[t]),t)?(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"sticky-header px-4 py-2 bg-emerald-700 text-white",children:[(0,a.jsx)("div",{className:"font-semibold",children:i||t}),(0,a.jsx)("div",{className:"text-xs opacity-90",children:t})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-3 space-y-1",style:{backgroundImage:"url('https://i.imgur.com/6IUbEMN.png')",backgroundSize:"cover"},children:[s.map((e,t)=>(0,a.jsx)(u,{m:e},e._id||t)),(0,a.jsx)("div",{ref:h})]}),(0,a.jsxs)("form",{onSubmit:p,className:"p-3 bg-white border-t flex gap-2",children:[(0,a.jsx)("input",{value:d,onChange:e=>f(e.target.value),placeholder:"Type a message",className:"flex-1 px-3 py-2 rounded-xl border"}),(0,a.jsx)("button",{className:"px-4 py-2 rounded-xl bg-green-600 text-white",children:"Send"})]})]}):(0,a.jsx)("div",{className:"flex-1 hidden md:flex items-center justify-center text-zinc-500",children:"Select a chat to start messaging"})}function h(){let[e,t]=(0,n.useState)();return(0,a.jsxs)("div",{className:"h-screen w-full grid grid-rows-[auto_1fr]",children:[(0,a.jsx)("div",{className:"px-4 py-2 border-b bg-emerald-700 text-white",children:"WhatsApp Web Clone"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-[20rem_1fr] h-full",children:[(0,a.jsx)(o,{onSelect:t,active:e}),(0,a.jsx)(f,{wa_id:e})]})]})}}},function(e){e.O(0,[40,971,23,744],function(){return e(e.s=2163)}),_N_E=e.O()}]);